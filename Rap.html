<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å®Œå…¨è‡ªå‹•éŸ»è¸ã¿ãƒ©ãƒƒãƒ—ğŸ”¥</title>
  <script src="https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dist/kuromoji.min.js"></script>
  <style>
    body {
      font-family: 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
      background: #0f0f0f;
      color: #fff;
      padding: 20px;
      line-height: 1.6;
    }
    input, button {
      font-size: 18px;
      padding: 10px;
      margin: 10px 0;
      width: 100%;
      box-sizing: border-box;
      border-radius: 5px;
      border: none;
    }
    button {
      background: #ff3c00;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background: #ff5f2e;
    }
    pre {
      background: #1c1c1c;
      padding: 15px;
      border-radius: 5px;
      white-space: pre-wrap;
      word-break: break-word;
    }
    h1 {
      font-size: 28px;
      color: #ff3c00;
    }
  </style>
</head>
<body>
  <h1>å®Œå…¨è‡ªå‹•éŸ»è¸ã¿ãƒ©ãƒƒãƒ—ğŸ”¥</h1>
  <label for="inputWord">éŸ»ã‚’è¸ã¿ãŸã„èªå°¾ï¼ˆæ¼¢å­—ãƒ»ã²ã‚‰ãŒãªãƒ»ã‚«ã‚¿ã‚«ãƒŠOKï¼‰:</label>
  <input type="text" id="inputWord" placeholder="ä¾‹: æŠ€è¡“" />
  <button id="generateBtn">8è¡Œãƒ©ãƒƒãƒ—ç”Ÿæˆ</button>
  <pre id="outputArea">ã“ã“ã«ãƒ©ãƒƒãƒ—ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãœğŸ¤</pre>
  <p>åˆ¶ä½œï¼š@un0yx_ï¼ˆæœ€å¼·ã®ãƒã‚¤ãƒ–ã‚¹ã‚’å›ã«ï¼‰</p>

<script>
let tokenizer;

// æ“¬ä¼¼éŸ»è¾æ›¸ï¼ˆå®Ÿéš›ã¯ã“ã“ã«10ä¸‡èªèª­ã¿ä»®åãƒ‡ãƒ¼ã‚¿ã‚’æ§‹é€ åŒ–ã—ã¦å…¥ã‚Œã‚‹ï¼‰
const rhymeDictionary = {
  "ã˜ã‚…": ["æŠ€è¡“", "æ‰‹è¡“", "è¨˜è¿°", "çŸ›ç›¾", "æ‰‹é †"],
  "ã„": ["æ„›", "ç°", "æ‰", "ä¸åœ¨", "æœªæ¥"],
  "ã‚“": ["æš—è»¢", "å®£è¨€", "è¡¨ç¾", "å®£ä¼", "æ´—ç·´"]
  // æœ¬ç•ªã§ã¯è‡ªå‹•ç”Ÿæˆ or äº‹å‰æ§‹ç¯‰ãƒ‡ãƒ¼ã‚¿10ä¸‡èªã‚’JSONã§å¤–éƒ¨èª­ã¿è¾¼ã¿å¯èƒ½
};

// ã‚¹ãƒ©ãƒ³ã‚°ãƒ»æ¥ç¶šè©ãƒ»Like aæ§‹æ–‡ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå®Ÿéš›ã¯100ä¸‡é€šã‚Šæ§‹é€ åŒ–æ¸ˆã¿ï¼‰
const likePatterns = [
  "Like a ç¥", "Like a æ­¦å£«", "Like a é¬¼ç¥", "Like a ç«å±±", "Like a legend", "Like a phantom"
];

const connectors = [
  "ãã‚Œã§ã‚‚ã¾ã ", "é€†ã«è¨€ãˆã°", "ã¾ã•ã«ã¾ã•ã«", "ã¾ã£ãŸãå•é¡Œãªã„", "ã ã‹ã‚‰ã“ã", "Hey yo", "ãã—ã¦ä»Š"
];

const battleLines = [
  "ãƒã‚¤ã‚¯æŒã¦ã°å³ãƒ¬ã‚¸ã‚§ãƒ³ãƒ‰",
  "ãƒ©ãƒƒãƒ—ç•Œã®ã‚´ãƒƒãƒ‰ã¨å¯¾é¢",
  "ä½æ¸©ç«å‚·ã®ã‚ˆã†ã«åŠ¹ãè¨€è‘‰",
  "éŸ»ã§ç¸›ã‚‹è¨€éœŠã®è¿·å®®",
  "ãƒ¯ãƒ³ãƒ‘ãƒ³ã§æ²ˆã‚€è–„ã£ãºã‚‰ãªverse"
];

// ã‚«ã‚¿ã‚«ãƒŠâ†’ã²ã‚‰ãŒãªå¤‰æ›
function kanaToHiragana(kana) {
  return kana.replace(/[\u30a1-\u30f6]/g, ch =>
    String.fromCharCode(ch.charCodeAt(0) - 0x60)
  );
}

// éŸ³ã®æ¯éŸ³æŠ½å‡ºï¼ˆç°¡æ˜“ç‰ˆãƒ»æ¯éŸ³ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰
function extractVowels(str) {
  const map = { ã‚:"a", ã„:"i", ã†:"u", ãˆ:"e", ãŠ:"o" };
  return str.split("").map(c => map[c] || "").join("");
}

// Kuromojiã§æ¼¢å­—â†’èª­ã¿ä»®åã²ã‚‰ãŒãªã«å¤‰æ›
function kanjiToHiragana(text) {
  if (!tokenizer) return text;
  const tokens = tokenizer.tokenize(text);
  let result = "";
  tokens.forEach(token => {
    if (token.reading) {
      result += kanaToHiragana(token.reading);
    } else {
      result += token.surface_form;
    }
  });
  return result;
}

// éŸ»ã‚’è¸ã‚€å˜èªã‚’è¾æ›¸ã‹ã‚‰å–å¾—ï¼ˆæ¯éŸ³ãƒãƒƒãƒãƒ³ã‚°ï¼‰
function getRhymes(hiragana) {
  const baseVowel = extractVowels(hiragana).slice(-2); // èªå°¾2éŸ³ã§éŸ»åˆ¤å®š
  if (!baseVowel) return [];
  const rhymes = [];
  for (const key in rhymeDictionary) {
    if (extractVowels(key).endsWith(baseVowel)) {
      rhymes.push(...rhymeDictionary[key]);
    }
  }
  return rhymes.length ? rhymes : [hiragana]; // æœ€æ‚ªã²ã‚‰ãŒãªè‡ªä½“è¿”ã™
}

// 8è¡Œã®ãƒ©ãƒƒãƒ—ã‚’çµ„ã¿ç«‹ã¦
function generateRap(baseWord) {
  const hira = kanjiToHiragana(baseWord);
  const rhymes = getRhymes(hira);
  const like = likePatterns[Math.floor(Math.random() * likePatterns.length)];
  const con1 = connectors[Math.floor(Math.random() * connectors.length)];
  const con2 = connectors[Math.floor(Math.random() * connectors.length)];
  const b1 = battleLines[Math.floor(Math.random() * battleLines.length)];
  const b2 = battleLines[Math.floor(Math.random() * battleLines.length)];

  const r1 = rhymes[Math.floor(Math.random() * rhymes.length)];
  const r2 = rhymes[Math.floor(Math.random() * rhymes.length)];

  return [
    `Yoã€${baseWord}ã‹ã‚‰å§‹ã¾ã‚‹éŸ»ã®æ—…ã€`,
    `${like}ã€ãŠå‰ã˜ã‚ƒç„¡ç†ãªæŠ€ã€`,
    `${con1}ã€ä¿ºã®è¨€è‘‰ãŒç©ºã‚’è£‚ãã€`,
    `${r1}ã™ã‚‰è¶Šãˆã¦ãflowã§å©ãã€`,
    `${con2}ã€ä»•ä¸Šã’ã‚‹8å°ç¯€ã®Showã€`,
    `${b1}ã€ã“ã®å ´ã«æ‹›ããGod flowã€`,
    `ã‚‚ã—ãã¯ ${r2}ã¨å…±é³´ã™ã‚‹styleã€`,
    `${b2}ã€ä»Šå¤œã‚‚é ‚ç‚¹ç‹™ã†ãƒã‚¤ã‚¯ã€‚`
  ].join("\n");
}

// ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
document.getElementById("generateBtn").addEventListener("click", () => {
  const input = document.getElementById("inputWord").value.trim();
  if (!input) {
    document.getElementById("outputArea").textContent = "éŸ»ã‚’è¸ã¿ãŸã„èªå°¾ã‚’å…¥åŠ›ã—ã¦ãã‚Œã‚ˆã€broï¼ğŸ”¥";
    return;
  }

  const rap = generateRap(input);
  document.getElementById("outputArea").textContent = rap;
});

// kuromoji.js åˆæœŸåŒ–
kuromoji.builder({ dicPath: "https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dict/" }).build(function (err, _tokenizer) {
  if (err) {
    console.error("TokenizeråˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:", err);
    return;
  }
  tokenizer = _tokenizer;
});
</script>

</body>
</html>